# 単体テスト仕様書 (Unit Test Specification)

## 1. 目的
本ドキュメントは、手書き数字判定アプリ (`tegaki`) の各モジュール（関数・クラス）が、設計通りに動作することを検証するためのテスト項目を定義する。

## 2. テスト対象範囲
- `src/main.py`: `AppLogic`, `ImageProcessor`, `Predictor` クラス（またはそれに相当する関数群）
- `src/train.py`: モデル学習機能（生成されるファイル形式の確認等）

## 3. テスト実施環境
- OS: Linux (Dev Container)
- Python: 3.x
- ライブラリ: `pytest`, `numpy`, `scikit-learn`, `pillow`

## 4. テスト項目

### 4.1 画像処理モジュール (ImageProcessor)

| ID | テスト項目名 | 前提条件 | 入力データ | 期待値 (Expected Result) | 備考 |
|----|------------|----------|-----------|-------------------------|------|
| UT-01 | 座標からの画像生成 | なし | 既知の座標データ (例: 直線) | 指定した座標に線が描画された 28x28 のNumPy配列が返されること | 値は0.0-1.0の範囲 |
| UT-02 | 空の入力処理 | なし | 空の座標リスト `[]` | 全て0の配列、またはエラーハンドリングされること | |
| UT-03 | 正規化の確認 | なし | 任意の座標データ | 配列の最大値が 1.0、最小値が 0.0 であること | |
| UT-04 | センタリング確認 | なし | 左端に偏った座標データ | 生成された画像で、重心が中心付近に移動していること | |

### 4.2 予測モジュール (Predictor)

| ID | テスト項目名 | 前提条件 | 入力データ | 期待値 (Expected Result) | 備考 |
|----|------------|----------|-----------|-------------------------|------|
| UT-05 | モデルロード成功 | `assets/mnist_model.pkl`が存在 | なし | 例外が発生せず、モデルオブジェクトがメモリに展開されること | |
| UT-06 | 正常系予測 | モデルロード済み | 手書き数字 '0' の典型的な画像配列 | 戻り値の label が 0、probability が 0.5 以上であること | |
| UT-07 | モデルファイル不在 | `assets/mnist_model.pkl`なし | なし | `FileNotFoundError` などの適切な例外が発生すること | |

### 4.3 状態管理 (State)

| ID | テスト項目名 | 前提条件 | 入力データ | 期待値 (Expected Result) | 備考 |
|----|------------|----------|-----------|-------------------------|------|
| UT-08 | ストローク追加 | なし | 新しい座標点 (x, y) | `state.current_stroke` に座標が追加されること | |
| UT-09 | ストローク確定 | 現在のストロークあり | `on_pan_end` イベント | `state.points` にストロークが保存され、`current_stroke` がリセットされること | |
| UT-10 | 全クリア | ストロークあり | 「クリア」操作 | `state.points` が空リストになること | |

## 5. 判定基準
すべてのテストケースにおいて、期待値と一致すること。自動テスト (`pytest`) が PASS すること。
